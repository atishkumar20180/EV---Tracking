
<div id="map" style="margin-right:10vw; width:98vw;"></div>

<% if(locals.driverId != null ) { %>
    <script>
        
// 
if (!navigator.geolocation) {
    console.log("Your browser doesn't support geolocation feature!")
} else {
    // setInterval(() => {
    //     navigator.geolocation.getCurrentPosition(getPosition)
    // }, 5000);
    navigator.geolocation.watchPosition(getPosition)
};

var marker, circle, lat, long, accuracy;

function getPosition(position) {
    
    lat = position.coords.latitude
    long = position.coords.longitude
    var coordinate=[lat,long]
    console.log(coordinate)
    accuracy = position.coords.accuracy

    if (marker) {
        map_init.removeLayer(marker)
    }

    if (circle) {
        map_init.removeLayer(circle)
    }

    marker = L.marker([lat, long])
    circle = L.circle([lat, long], { radius: accuracy })

    var featureGroup = L.featureGroup([marker, circle]).addTo(map_init)

  //  map_init.fitBounds(featureGroup.getBounds())
  var driver= <%- JSON.stringify(driverId) %>
        //  console.log(driver)
        //  console.log(lat)
        // console.log('hello atish')
         setInterval(()=>{socket.emit("sendLocation",{driverId:driver,latitude:lat,longitude:long});},5000)
       // socket.emit("sendLocation",{driverId:driver,latitude:lat,longitude:long});
        
  

    console.log("Your coordinate is: Lat: " + lat + " Long: " + long + " Accuracy: " + accuracy)
}
         
    </script>
<% } %> 

<script>
    var markers_array=[];
socket.on("driverLocation", location =>{
    var lat1,long1,marker1;
    lat1=location.latitude;
    long1=location.longitude;
    console.log(lat1,long1,"location recieved")
    // marker1=L.marker([lat1, long1])
    // var featureGroup = L.featureGroup([marker1]).addTo(map_init)
    
    if (!markers_array[location.driverId] ) {
            markers_array[location.driverId] = L.marker([lat1, long1]).bindPopup(location.driverId).addTo(map_init);
            } else {
                markers[location.driverId]
            markers_array[location.driverId].setLatLng(lat1, long1).setPopupContent(location.driverId).update();
            }


})
</script>

      
   
   
